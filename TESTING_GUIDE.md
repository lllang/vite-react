# 测试指南

## 🎯 测试目标

验证从不同环境跳转到微信小程序的功能是否正常。

## 📋 测试前准备

1. ✅ 项目已部署到 Vercel
2. ✅ 获得 HTTPS 访问链接
3. ✅ 手机已安装微信
4. ✅ 手机能正常上网

## 🧪 测试场景

### 场景 1：系统浏览器测试

**测试环境：** iPhone Safari / Android Chrome

**测试步骤：**
1. 在手机浏览器中输入部署链接
2. 观察页面顶部显示的环境信息
3. 等待 1.5 秒，观察是否自动跳转
4. 如果没有自动跳转，点击"点击跳转微信"按钮
5. 观察是否弹出跳转确认对话框
6. 点击确认，观察微信是否打开

**预期结果：**
- ✅ 显示环境为 "Safari浏览器" 或 "Chrome浏览器"
- ⚠️ iOS Safari 可能成功跳转
- ⚠️ Android Chrome 成功率较高
- ℹ️ 可能需要手动点击按钮

---

### 场景 2：抖音内置浏览器测试

**测试环境：** 抖音 App 内置浏览器

**测试步骤：**
1. 将部署链接复制
2. 在抖音中发送给自己或好友
3. 在抖音中点击链接打开
4. 观察页面显示
5. 查看是否有跳转提示
6. 尝试点击按钮跳转

**预期结果：**
- ✅ 显示环境为 "抖音内置浏览器"
- ❌ 大概率无法跳转（除非域名在白名单）
- ℹ️ 页面会显示"跳转可能失败"的提示
- 💡 可以点击"复制当前链接"然后在系统浏览器打开

---

### 场景 3：钉钉内置浏览器测试

**测试环境：** 钉钉 App 内置浏览器

**测试步骤：**
1. 将部署链接复制
2. 在钉钉中发送给自己或同事
3. 在钉钉中点击链接打开
4. 观察自动跳转情况

**预期结果：**
- ✅ 显示环境为 "钉钉内置浏览器"
- ✅ 某些版本可能直接跳转
- ⚠️ 可能需要点击按钮跳转
- ✅ 成功率较高

---

### 场景 4：微信内置浏览器测试

**测试环境：** 微信 App 内置浏览器

**测试步骤：**
1. 将部署链接发送到微信
2. 在微信中点击链接打开
3. 观察页面显示

**预期结果：**
- ✅ 显示环境为 "微信内置浏览器"
- ✅ 页面显示"检测到微信环境，无需跳转"
- ℹ️ 不会尝试跳转（已经在微信中）

---

### 场景 5：多次点击按钮测试

**测试目的：** 验证不同跳转方式的轮换

**测试步骤：**
1. 在任意浏览器打开页面
2. 多次点击"点击跳转微信"按钮
3. 观察调试信息中的"尝试次数"增加
4. 每次点击会尝试不同的跳转方式：
   - 第 1 次：location
   - 第 2 次：window.open
   - 第 3 次：iframe
   - 第 4 次：a标签点击
   - 第 5 次：再次循环...

**预期结果：**
- ✅ 每次点击尝试次数 +1
- ✅ 不同方式可能有不同效果
- ℹ️ 观察哪种方式最有效

---

## 📊 测试记录表格

| 测试场景 | 环境显示 | 自动跳转 | 手动跳转 | 成功率 | 备注 |
|---------|---------|---------|---------|--------|------|
| Safari | ✅ | ⚠️ | ⚠️ | 中等 | |
| Chrome | ✅ | ⚠️ | ✅ | 较高 | |
| 抖音 | ✅ | ❌ | ❌ | 低 | |
| 钉钉 | ✅ | ✅ | ✅ | 高 | |
| 微信 | ✅ | N/A | N/A | N/A | |

## 🔍 调试信息说明

页面上会显示以下调试信息：

1. **环境信息**（页面顶部）：
   - 当前运行环境
   - User Agent 前 30 字符

2. **状态信息**（中间区域）：
   - 当前跳转状态
   - 颜色编码：
     - 🔵 蓝色：正在处理
     - 🟢 绿色：成功
     - 🟡 黄色：警告
     - 🔴 红色：错误

3. **调试信息**（底部区域）：
   - 使用的 Scheme
   - 尝试跳转的次数

## 🐛 常见问题排查

### 问题 1：页面显示空白

**可能原因：**
- 部署失败
- JavaScript 加载错误
- 浏览器不兼容

**排查方法：**
1. 打开浏览器开发者工具
2. 查看 Console 是否有错误
3. 查看 Network 面板确认资源加载

### 问题 2：点击按钮无反应

**可能原因：**
- 按钮被禁用
- JavaScript 错误
- 跳转被拦截

**排查方法：**
1. 查看按钮是否有 disabled 样式
2. 查看 Console 是否有错误
3. 尝试刷新页面重试

### 问题 3：跳转后打开的不是预期的小程序

**可能原因：**
- Scheme 配置错误
- Scheme 已过期
- 指向的是测试小程序

**解决方法：**
1. 检查 `src/App.tsx` 中的 `wechatScheme`
2. 确认 Scheme 是否有效
3. 必要时重新生成 Scheme

### 问题 4：跳转成功但微信显示"页面不存在"

**可能原因：**
- Scheme 对应的小程序页面不存在
- 小程序未上线或已下线
- Scheme 参数错误

**解决方法：**
1. 确认小程序正常运行
2. 检查 Scheme 中的路径参数
3. 使用新的有效 Scheme

## 📱 最佳测试实践

### 1. 准备测试设备

- iOS 设备（iPhone）
- Android 设备
- 不同品牌的手机（小米、华为、OPPO 等）

### 2. 安装必要的 App

- 微信（最新版本）
- 抖音
- 钉钉
- Safari / Chrome

### 3. 测试步骤建议

1. **先测试系统浏览器**（基准测试）
2. **再测试各种 App 内置浏览器**
3. **记录不同环境的表现**
4. **总结成功率和失败原因**

### 4. 远程调试

**iOS Safari 调试：**
1. Mac 连接 iPhone
2. 打开 Safari → 开发 → [你的iPhone]
3. 选择对应页面
4. 查看 Console 和 Network

**Android Chrome 调试：**
1. 手机开启 USB 调试
2. 电脑打开 `chrome://inspect`
3. 连接手机
4. 选择对应页面
5. 查看 DevTools

## 🎯 测试完成检查清单

- [ ] 在至少 2 种系统浏览器中测试
- [ ] 在至少 1 种 App 内置浏览器中测试
- [ ] 验证环境检测是否准确
- [ ] 验证自动跳转功能
- [ ] 验证手动按钮功能
- [ ] 验证复制链接功能
- [ ] 查看调试信息是否正常显示
- [ ] 记录各环境的成功率
- [ ] 识别改进方向

## 📈 测试结果分析

### 成功指标

- ✅ 环境检测准确率：> 90%
- ✅ 系统浏览器跳转成功率：> 60%
- ✅ 钉钉浏览器跳转成功率：> 70%
- ⚠️ 抖音浏览器跳转成功率：< 20%（正常）

### 改进方向

1. **提高成功率：**
   - 添加更多跳转方式
   - 优化跳转时机
   - 添加 iOS Universal Link 支持

2. **用户体验：**
   - 添加更清晰的引导提示
   - 显示二维码备用方案
   - 提供帮助文档链接

3. **兼容性：**
   - 测试更多浏览器和设备
   - 适配特殊环境
   - 添加降级方案

## 💡 技巧和提示

1. **使用二维码测试：**
   - 生成部署链接的二维码
   - 扫码更方便在多个 App 中测试

2. **批量测试：**
   - 准备多个测试链接
   - 使用短链接服务
   - 方便分享和测试

3. **模拟真实场景：**
   - 假装是朋友分享的链接
   - 观察用户实际操作路径
   - 优化用户体验

4. **记录测试数据：**
   - 使用表格记录每次测试
   - 分析成功和失败的模式
   - 数据驱动优化决策

## 📞 获取帮助

如果测试中遇到问题：
1. 查看 README.md 中的常见问题
2. 查看 DEPLOYMENT.md 中的详细说明
3. 检查浏览器控制台的错误信息
4. 记录详细的测试环境和步骤

祝测试顺利！🎉

